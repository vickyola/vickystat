---
title: "My plots"


```{r include = FALSE}
library("here")
library("conflicted")
library("readxl")
library("rgdal")
library("tidyverse")
library("ggplot2")
library("ggridges")
library("hrbrthemes")
library("magrittr")
library("viridis")
library("RColorBrewer")
library("tidytext")
#load data:

#read csv file Version 1! version2 would be better, where is it?

bdata <- read.csv(here("bird_classification_v1","bird_classification_v1.csv"), check.names=TRUE,sep=",")

plotdat_occu_count <- bdata %>%  dplyr::filter(Rank==1,) %>%
  dplyr::select("Site","Common.Name","permanent_grassland_proportion_class","edge_length_class","date")%>% 
  group_by(Site, Common.Name) %>% mutate(numocc = length((Common.Name)) ) %>%
  distinct(Common.Name , Site, .keep_all= TRUE) 
#Site categorical
#plotdat_occu_count$Site = as.factor(plotdat_occu_count$Site) #vllt nich?

#ordering 
plotdat_occu_count$Site <- reorder(plotdat_occu_count$Site,plotdat_occu_count$edge_length_class)

#new collumn counts of occurence
#plotdat_occu_count <- bdata %>%  dplyr::filter(Rank==1,) %>% dplyr::select("Site","Common.Name","permanent_grassland_proportion_class","edge_length_class","date")%>% group_by(Site, Common.Name) %>% mutate(numocc = length((Common.Name)) ) %>%  distinct(Common.Name , Site, .keep_all= TRUE) 


```



```{r include= FALSE}
#Interactive Plotting 
#choose dataset to plot
data <- plotdat_occu_count  #  %>% filter(year=="2007") %>% dplyr::select(-year)

 #irgendwie size  zu Summe machen
#if(!is.null(dev.list())) dev.off()
#dev.off()

 # scale_x_discrete(limits = pos,
        #           labels = unique(data$edge_length_class))+ #limits = pos,
        
  
```


```{r, out.width="100%",fig.dim = c(10, 24)}
#overview occurence Bubble Plot

cls <-ggplot(data, aes(x= Site, y=reorder_within(x = Common.Name, by = numocc, within=Common.Name, FUN =sum ),size =      numocc,color=as.factor(numocc) )) + #colour = Common.Name ,
  geom_point(alpha = 0.5,aes(fill = numocc)) + 
  scale_fill_viridis( option="A")+
  scale_size(range = c(.1, 24) )+
  scale_color_viridis(discrete=TRUE, guide=FALSE,direction =- 1,option = "viridis")+
  scale_y_reordered() +
  labs(x ="Site", y= "Common Name", size = "number of detections", 
       col="Common Name")+
  theme_minimal()  +
    #  expand_limits(y= c(-4, length(levels(data$Common.Name)) + 4))+
  theme(axis.text=element_text(size=8),legend.position = "none")


cls



```


